(window.webpackJsonp=window.webpackJsonp||[]).push([["modules/endofcontent","shared/contenthistory"],{"1756ce4146624cb0acd9":function(t,e,s){"use strict";(function(t){var i=s("2021383dc2c60c412d80"),n=s("654adc4d2d3e5dbaee18");e.a=t.Collection.extend({endpoint:"ajax/endofcontent",initialize:function(t,e){this.limit=Object(n.j)("limit",e,2)},parse:function(t){var e=(new i.default).filterArticlesFromUserHistory(t,this.limit);return e.length?{data:e}:[]},hasEnoughArticles:function(){return!!this.at(0)&&this.at(0).get("data").length>=this.limit}})}).call(this,s("292bef011bf0a540c727"))},"2021383dc2c60c412d80":function(t,s,o){"use strict";o.r(s),function(h){function t(t){this.contentNamespace=t||"hrst.content.history",this.contentId=e.a.getValue("content.id"),this.logger=new i.a("ContentHistory"),this.addContent()}var e=o("7ec90be294f8945e7663"),i=o("891a19eb7d3552f95f46"),u=o("654adc4d2d3e5dbaee18"),n=window.localStorage;t.prototype={maxArticles:50,addContent:function(){var t=[];if(this.contentId){try{t=JSON.parse(n.getItem(this.contentNamespace))}catch(t){this.logger.warn("Cannot parse content history. ",t)}h.isArray(t)||(t=[]),-1<t.indexOf(this.contentId)||(t.length>=this.maxArticles&&(t=t.slice(1,this.maxArticles)),t.push(this.contentId),n.setItem(this.contentNamespace,JSON.stringify(t)))}else this.logger.warn("contentId not found.")},filterArticlesFromUserHistory:function(t,e,i){var n,s,o,a=[],d=[],l=[],c=0,r=t.length;if(!h.isArray(t))return d;if((e=~~e)<=0)return t;try{a=JSON.parse(localStorage.getItem(this.contentNamespace))}catch(t){this.logger.warn("Cannot read user content history. ",t)}if(!h.isArray(a))return t.slice(0,e);for(n=0;n<r&&!(e<=c);n+=1)s=Object(u.j)("id",t[n]),o=a.indexOf(s),s&&o<0?(d.push(t[n]),c+=1):l.push({data:t[n],order:o});return i?d.concat(h.pluck(h.sortBy(l,"order"),"data").slice(0,e-d.length)):d.length?d:t.slice(0,e)}},s.default=t}.call(this,o("37047f07c1f267630157"))},fa65660094c951eb8658:function(t,c,r){"use strict";r.r(c),function(t,s,e){var i=r("abfbe0c0349d83b0558c"),n=r("7ec90be294f8945e7663"),o=r("1756ce4146624cb0acd9"),a=r("d46c288b6d4387f2b7de"),d=r("891a19eb7d3552f95f46"),l=r("654adc4d2d3e5dbaee18");c.default=t.View.extend({el:"body",initialize:function(){this.setVariables(),this.setListeners()},setVariables:function(){this.overrideDefaults({displayEvent:"render.apps.eoc",ensightenFlagName:"HRST.article.showEOCLinks",itemModel:a.a.prototype.ModelTemplate,itemView:a.a,mediaLoader:null,moduleSelector:".end-of-content-module",moduleTemplate:"#eoc-module-template",adClass:"ad-active",adSelector:".eoc-ad",renderedClass:"rendered"}),this.$window=s(window),this.logger=new d.a("EndOfContent"),this.collection=new o.a([],{model:this.itemModel}),this.contentId=n.a.getValue("content.id"),this.$module=s(this.moduleSelector),this.mediaLoader=Object(l.d)(this.mediaLoader,i.default),this.state=this.getInitialState(),this.request={},this.$eocAd=s(this.adSelector),window.teadsObj=e.extend(window.teadsObj||{},{adAvailable:[this.toggleAd.bind(this,!0)],noAd:[this.toggleAd.bind(this,!1)],complete:[this.toggleAd.bind(this,!1)]})},setListeners:function(){this.collection.on("sync",this.collectionSync.bind(this)),this.$window.one(this.displayEvent,this.handleEnsightenDisplay.bind(this))},getInitialState:function(){return{isEnabled:!!this.$module.length,canDisplay:Object(l.j)(this.ensightenFlagName,window),modulesLoaded:!1}},collectionSync:function(){var i=s(),n=this.itemView;this.collection.hasEnoughArticles()?this.state.modulesLoaded?this.logger.log("No modules to load."):(this.logger.log("Sync",arguments),this.collection.each(function(t){var e=s(new n({model:t,templateSelector:this.moduleTemplate}).render().el);i=i.add(e)}.bind(this)),this.$module.attr("data-tracking-id","recirc-end-of-content").prepend(i).addClass(this.renderedClass),this.state.modulesLoaded=!0):this.logger.log("Not enough articles.")},handleEnsightenDisplay:function(){this.state.canDisplay=!0,this.fetchModules()},fetchModules:function(){return this.contentId&&this.state.isEnabled&&!this.state.modulesLoaded?0<this.request.readyState?(this.logger.log("There is a fetch in progress, exiting"),!1):this.state.canDisplay?(this.request=this.collection.fetch({data:{id:this.contentId}}).fail(this.handleFetchError.bind(this)),!0):(this.logger.log("Moduled disabled by showEOCLinks in HRST object"),!1):(this.logger.log("No modules to load."),!1)},handleFetchError:function(){this.logger.error("Error fetching end of content modules."),this.$module.empty()},toggleAd:function(t){this.$module.toggleClass(this.adClass,t),this.logger.log("EOC ad:"+t)}})}.call(this,r("292bef011bf0a540c727"),r("4124695a4a0df23fd56c"),r("37047f07c1f267630157"))}}]);
//# sourceMappingURL=endofcontent.0dc5e5a.js.map